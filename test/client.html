<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Server WebSocket Tester</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; background-color: #f5f5f7; }
        .container { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .status { padding: 8px 16px; border-radius: 20px; font-size: 14px; font-weight: bold; }
        .status.connected { background: #e3f9e5; color: #1f7a1f; }
        .status.disconnected { background: #ffebee; color: #c62828; }
        .input-group { margin: 15px 0; display: flex; gap: 10px; }
        input[type="text"] { flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px; }
        button { padding: 10px 20px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; transition: 0.2s; }
        button.primary { background: #007aff; color: white; }
        button.primary:hover { background: #0056b3; }
        button.danger { background: #ff3b30; color: white; }
        #log { height: 400px; overflow-y: auto; background: #1e1e1e; color: #00ff00; padding: 15px; border-radius: 8px; font-family: monospace; margin-top: 20px; font-size: 14px; }
        .msg-sent { color: #f0f0f0; }
        .msg-recv { color: #00ff00; }
        .msg-sys { color: #ffeb3b; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéÆ Game Server Tester</h1>

        <div class="input-group">
            <input type="text" id="wsUrl" value="ws://localhost:8080/ws" placeholder="WebSocket URL">
            <button id="btnConnect" class="primary" onclick="connect()">ÈÄ£Á∑ö</button>
            <button id="btnDisconnect" class="danger" onclick="disconnect()" disabled>Êñ∑Á∑ö</button>
            <span id="statusBadge" class="status disconnected">Disconnected</span>
        </div>

        <div class="input-group">
            <input type="text" id="msgInput" placeholder="Ëº∏ÂÖ•Ë®äÊÅØ..." onkeypress="if(event.key === 'Enter') send()">
            <button class="primary" onclick="send()" id="btnSend" disabled>ÁôºÈÄÅ</button>
        </div>

        <div id="log"></div>
    </div>

    <script>
        let ws;
        const logDiv = document.getElementById('log');
        const statusBadge = document.getElementById('statusBadge');
        const btnConnect = document.getElementById('btnConnect');
        const btnDisconnect = document.getElementById('btnDisconnect');
        const btnSend = document.getElementById('btnSend');

        function connect() {
            const url = document.getElementById('wsUrl').value;
            ws = new WebSocket(url);

            ws.onopen = () => {
                updateStatus(true);
                logMsg('System', 'Connected to ' + url, 'msg-sys');
            };

            ws.onclose = (event) => {
                updateStatus(false);
                logMsg('System', `Disconnected (Code: ${event.code})`, 'msg-sys');
            };

            ws.onerror = (error) => {
                logMsg('System', 'Error detected', 'msg-sys');
                console.error(error);
            };

            ws.onmessage = (event) => {
                logMsg('Server', event.data, 'msg-recv');
            };
        }

        function disconnect() {
            if (ws) {
                ws.close();
            }
        }

        function send() {
            const input = document.getElementById('msgInput');
            const txt = input.value;
            if (ws && ws.readyState === WebSocket.OPEN && txt) {
                ws.send(txt);
                logMsg('You', txt, 'msg-sent');
                input.value = '';
            }
        }

        function updateStatus(connected) {
            btnConnect.disabled = connected;
            document.getElementById('wsUrl').disabled = connected;
            btnDisconnect.disabled = !connected;
            btnSend.disabled = !connected;

            statusBadge.className = 'status ' + (connected ? 'connected' : 'disconnected');
            statusBadge.textContent = connected ? 'Connected' : 'Disconnected';
        }

        function logMsg(source, msg, cls) {
            const div = document.createElement('div');
            const time = new Date().toLocaleTimeString();
            div.className = cls;
            div.innerHTML = `[${time}] <strong>${source}:</strong> ${msg}`;
            logDiv.appendChild(div);
            logDiv.scrollTop = logDiv.scrollHeight;
        }
    </script>
</body>
</html>
